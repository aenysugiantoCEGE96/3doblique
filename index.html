<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CesiumJS: Add a 3D Object layer (I3S)</title>
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    html,
    body {

        margin: 0px;
        padding: 0px;
        height: 100%;
    }
    #cesiumContainer {
        height: 100%;
    }
  </style>
</head>
<body>

  <div id="cesiumContainer"></div>
  <script type="module">

    const apiKey = "AAPK4de2b746d8e44b05ace866c82462a062FTcxr96S-A11i51NDKRDHrLGTox-5_QnihVa8F8G1YQFAtWQEQlepiNzvHiomKta";

    Cesium.ArcGisMapService.defaultAccessToken = apiKey;

    const cesiumAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2NDAyMTk3Zi03NGFiLTRiZGUtYTgzMi1hMzc4MmM3NTcyOTAiLCJpZCI6MTQ5Mzk5LCJpYXQiOjE2ODk5NDc5MDZ9.hyqOWjXUe3Yf2JBqfu0Kg0amnKtoV9s29M0GoQlu3iY";
    Cesium.Ion.defaultAccessToken = cesiumAccessToken;

    const arcGisImagery = Cesium.ArcGisMapServerImageryProvider.fromBasemapType(Cesium.ArcGisBaseMapType.SATELLITE, {
      enablePickFeatures:false
    });

    const viewer = new Cesium.Viewer("cesiumContainer", {

        baseLayer: Cesium.ImageryLayer.fromProviderAsync(arcGisImagery),

        terrain: Cesium.Terrain.fromWorldTerrain(),
        timeline: false,
        animation: false,
        geocoder:false

    });

    viewer.camera.setView({
      destination: Cesium.Cartesian3.fromDegrees(-122.43305,37.77655,500),
      orientation: {
        heading: Cesium.Math.toRadians(60),
        pitch: Cesium.Math.toRadians(-15.0),
      }
    });

    // Initialize a terrain provider which provides geoid conversion between gravity related (typically I3S datasets) and ellipsoidal based
    // height systems (Cesium World Terrain).
    // If this is not specified, or the URL is invalid no geoid conversion will be applied.
    // The source data used in this transcoding service was compiled from https://earth-info.nga.mil/#tab_wgs84-data and is based on EGM2008 Gravity Model
    const geoidService = await Cesium.ArcGISTiledElevationTerrainProvider.fromUrl("https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/EGM2008/ImageServer");

    const i3sLayer = "https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/SanFrancisco_3DObjects_1_7/SceneServer";

    const i3sProvider = await Cesium.I3SDataProvider.fromUrl(i3sLayer, {
        geoidTiledTerrainProvider: geoidService,
        token: apiKey
    })

    viewer.scene.primitives.add(i3sProvider);

  </script>

  </body>
</html>
